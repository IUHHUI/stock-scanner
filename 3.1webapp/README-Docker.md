# ğŸ³ AIå¢å¼ºè‚¡ç¥¨åˆ†æç³»ç»Ÿ - ç®€åŒ–Dockeréƒ¨ç½²æŒ‡å—

## ğŸ“‹ éƒ¨ç½²æ¦‚è§ˆ

æœ¬é¡¹ç›®æä¾›äº†**æœ€ç®€åŒ–çš„Dockerå®¹å™¨åŒ–éƒ¨ç½²æ–¹æ¡ˆ**ï¼Œé‡‡ç”¨å•å®¹å™¨æ¶æ„ï¼Œå¿«é€Ÿå¯åŠ¨ï¼Œæ˜“äºç®¡ç†ã€‚

### ğŸ¯ éƒ¨ç½²ç‰¹ç‚¹

- âœ… **å•å®¹å™¨éƒ¨ç½²** - åªæœ‰ä¸€ä¸ªFlaskåº”ç”¨å®¹å™¨
- âœ… **é›¶ä¾èµ–** - ä¸éœ€è¦Redisã€Nginxç­‰é¢å¤–æœåŠ¡
- âœ… **å¿«é€Ÿå¯åŠ¨** - ä¸€é”®éƒ¨ç½²ï¼Œç«‹å³ä½¿ç”¨
- âœ… **æœ¬åœ°å­˜å‚¨** - ä½¿ç”¨æœ¬åœ°ç›®å½•å­˜å‚¨æ—¥å¿—å’Œç¼“å­˜
- âœ… **æ˜“äºç»´æŠ¤** - é…ç½®ç®€å•ï¼Œæ•…éšœæ’æŸ¥å®¹æ˜“

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# ç¡®ä¿å·²å®‰è£…Dockerå’ŒDocker Compose
docker --version
docker-compose --version

# è¿›å…¥é¡¹ç›®ç›®å½•
cd stock-scanner/3.1webapp
```

### 2. é…ç½®APIå¯†é’¥

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡ç¤ºä¾‹æ–‡ä»¶
cp env.example .env

# ç¼–è¾‘.envæ–‡ä»¶ï¼Œå¡«å…¥æ‚¨çš„APIå¯†é’¥
nano .env
```

**å¿…éœ€é…ç½®**ï¼ˆè‡³å°‘é…ç½®ä¸€ä¸ªï¼‰ï¼š
```bash
OPENAI_API_KEY=sk-your-openai-api-key-here
ANTHROPIC_API_KEY=sk-ant-your-claude-api-key-here  
ZHIPU_API_KEY=your-zhipu-api-key-here
```

### 3. ä¸€é”®å¯åŠ¨

```bash
# åˆ›å»ºå¿…è¦çš„æœ¬åœ°ç›®å½•
mkdir -p logs cache data

# å¯åŠ¨æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

### 4. è®¿é—®åº”ç”¨

- **åº”ç”¨åœ°å€**: http://localhost:5000
- **APIçŠ¶æ€**: http://localhost:5000/api/status

## ğŸ“Š éƒ¨ç½²æ¶æ„

### ç®€åŒ–æ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·æµè§ˆå™¨     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ :5000
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Stock Analyzer â”‚
â”‚   (Flask App)   â”‚
â”‚                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ æœ¬åœ°ç¼“å­˜     â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ æœ¬åœ°æ—¥å¿—     â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âš™ï¸ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡é…ç½®

| å˜é‡å | è¯´æ˜ | é»˜è®¤å€¼ | å¿…éœ€ |
|--------|------|--------|------|
| `OPENAI_API_KEY` | OpenAI APIå¯†é’¥ | - | æ˜¯* |
| `ANTHROPIC_API_KEY` | Claude APIå¯†é’¥ | - | æ˜¯* |
| `ZHIPU_API_KEY` | æ™ºè°±AI APIå¯†é’¥ | - | æ˜¯* |
| `FLASK_ENV` | Flaskç¯å¢ƒ | production | å¦ |
| `TZ` | æ—¶åŒº | Asia/Shanghai | å¦ |
| `MAX_WORKERS` | æœ€å¤§å·¥ä½œçº¿ç¨‹ | 4 | å¦ |

*è‡³å°‘éœ€è¦é…ç½®ä¸€ä¸ªAI APIå¯†é’¥

### ç«¯å£é…ç½®

| æœåŠ¡ | ç«¯å£ | è¯´æ˜ |
|------|------|------|
| Flaskåº”ç”¨ | 5000 | ä¸»åº”ç”¨æœåŠ¡ |

### ç›®å½•ç»“æ„

```
3.1webapp/
â”œâ”€â”€ docker-compose.yaml    # Dockeré…ç½®æ–‡ä»¶
â”œâ”€â”€ Dockerfile            # é•œåƒæ„å»ºæ–‡ä»¶
â”œâ”€â”€ .env                  # ç¯å¢ƒå˜é‡é…ç½®
â”œâ”€â”€ config.json           # åº”ç”¨é…ç½®æ–‡ä»¶
â”œâ”€â”€ logs/                 # æ—¥å¿—ç›®å½• (è‡ªåŠ¨åˆ›å»º)
â”œâ”€â”€ cache/                # ç¼“å­˜ç›®å½• (è‡ªåŠ¨åˆ›å»º)
â””â”€â”€ data/                 # æ•°æ®ç›®å½• (è‡ªåŠ¨åˆ›å»º)
```

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

### åŸºæœ¬æ“ä½œ

```bash
# å¯åŠ¨æœåŠ¡
docker-compose up -d

# åœæ­¢æœåŠ¡
docker-compose down

# é‡å¯æœåŠ¡
docker-compose restart

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# å®æ—¶æŸ¥çœ‹æœ€æ–°æ—¥å¿—
docker-compose logs --tail=50 -f
```

### ç»´æŠ¤æ“ä½œ

```bash
# æ›´æ–°åº”ç”¨
docker-compose build --no-cache
docker-compose up -d

# æ¸…ç†æ—§é•œåƒ
docker image prune -f

# æŸ¥çœ‹èµ„æºä½¿ç”¨
docker stats stock-analyzer-webapp
```

### è°ƒè¯•æ“ä½œ

```bash
# è¿›å…¥å®¹å™¨
docker-compose exec stock-analyzer bash

# æŸ¥çœ‹å®¹å™¨å†…æ–‡ä»¶
docker-compose exec stock-analyzer ls -la /app

# æŸ¥çœ‹é…ç½®
docker-compose exec stock-analyzer cat /app/config.json
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### èµ„æºé…ç½®

æ ¹æ®æœåŠ¡å™¨é…ç½®è°ƒæ•´`docker-compose.yaml`ä¸­çš„èµ„æºé™åˆ¶ï¼š

```yaml
deploy:
  resources:
    limits:
      cpus: '2.0'        # CPUæ ¸å¿ƒæ•°
      memory: 2G         # å†…å­˜é™åˆ¶
    reservations:
      cpus: '0.5'        # CPUé¢„ç•™
      memory: 512M       # å†…å­˜é¢„ç•™
```

### å»ºè®®é…ç½®

- **æœ€å°é…ç½®**: 1æ ¸CPU + 512MBå†…å­˜
- **æ¨èé…ç½®**: 2æ ¸CPU + 2GBå†…å­˜
- **é«˜è´Ÿè½½é…ç½®**: 4æ ¸CPU + 4GBå†…å­˜

## ğŸ›¡ï¸ å®‰å…¨é…ç½®

### 1. å¯ç”¨Webå¯†ç ä¿æŠ¤

ç¼–è¾‘`config.json`æ–‡ä»¶ï¼š
```json
{
  "web_auth": {
    "enabled": true,
    "password": "your_secure_password",
    "session_timeout": 3600
  }
}
```

### 2. é˜²ç«å¢™é…ç½®

```bash
# ä»…å¼€æ”¾å¿…è¦ç«¯å£
ufw allow 5000/tcp
ufw enable
```

### 3. å®šæœŸæ›´æ–°

```bash
# å®šæœŸæ›´æ–°é•œåƒ
docker-compose pull
docker-compose up -d
```

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **å®¹å™¨å¯åŠ¨å¤±è´¥**
   ```bash
   # æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯
   docker-compose logs stock-analyzer
   
   # æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•
   docker-compose config
   ```

2. **APIå¯†é’¥é”™è¯¯**
   ```bash
   # æ£€æŸ¥ç¯å¢ƒå˜é‡
   docker-compose exec stock-analyzer env | grep API_KEY
   
   # é‡æ–°åŠ è½½ç¯å¢ƒå˜é‡
   docker-compose down
   docker-compose up -d
   ```

3. **ç«¯å£å†²çª**
   ```bash
   # æŸ¥çœ‹ç«¯å£å ç”¨
   netstat -tlnp | grep :5000
   
   # ä¿®æ”¹ç«¯å£æ˜ å°„ (åœ¨docker-compose.yamlä¸­)
   ports:
     - "5001:5000"  # æ”¹ä¸º5001ç«¯å£
   ```

4. **ç£ç›˜ç©ºé—´ä¸è¶³**
   ```bash
   # æ¸…ç†æ—¥å¿—æ–‡ä»¶
   rm -rf logs/*
   
   # æ¸…ç†Dockerç¼“å­˜
   docker system prune -f
   ```

5. **å†…å­˜ä¸è¶³**
   ```bash
   # ç›‘æ§å†…å­˜ä½¿ç”¨
   docker stats
   
   # å‡å°‘å·¥ä½œçº¿ç¨‹æ•°
   # åœ¨.envæ–‡ä»¶ä¸­è®¾ç½®: MAX_WORKERS=2
   ```

### æ—¥å¿—åˆ†æ

```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
docker-compose logs -f stock-analyzer

# æŸ¥çœ‹æœ¬åœ°æ—¥å¿—æ–‡ä»¶
tail -f logs/app.log

# æœç´¢é”™è¯¯æ—¥å¿—
grep -i error logs/*.log
```

## ğŸ“¦ æ•°æ®ç®¡ç†

### å¤‡ä»½æ•°æ®

```bash
# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p backups/$(date +%Y%m%d)

# å¤‡ä»½é…ç½®å’Œæ•°æ®
cp config.json backups/$(date +%Y%m%d)/
cp .env backups/$(date +%Y%m%d)/
cp -r logs backups/$(date +%Y%m%d)/
cp -r cache backups/$(date +%Y%m%d)/
cp -r data backups/$(date +%Y%m%d)/

echo "å¤‡ä»½å®Œæˆ: backups/$(date +%Y%m%d)/"
```

### æ¢å¤æ•°æ®

```bash
# åœæ­¢æœåŠ¡
docker-compose down

# æ¢å¤æ•°æ®
cp -r backups/20240101/* ./

# é‡å¯æœåŠ¡
docker-compose up -d
```

### æ¸…ç†æ•°æ®

```bash
# æ¸…ç†ç¼“å­˜
rm -rf cache/*

# æ¸…ç†æ—§æ—¥å¿— (ä¿ç•™æœ€è¿‘7å¤©)
find logs/ -name "*.log" -mtime +7 -delete

# é‡å¯æœåŠ¡ä»¥é‡æ–°åˆ›å»ºå¿…è¦æ–‡ä»¶
docker-compose restart
```

## ğŸš€ ç”Ÿäº§ç¯å¢ƒå»ºè®®

1. **å®šæœŸå¤‡ä»½** - è®¾ç½®å®šæ—¶å¤‡ä»½è„šæœ¬
2. **ç›‘æ§å‘Šè­¦** - ç›‘æ§å®¹å™¨å¥åº·çŠ¶æ€
3. **æ—¥å¿—è½®è½¬** - é˜²æ­¢æ—¥å¿—æ–‡ä»¶è¿‡å¤§
4. **å®‰å…¨æ›´æ–°** - å®šæœŸæ›´æ–°åŸºç¡€é•œåƒ
5. **èµ„æºç›‘æ§** - ç›‘æ§CPUå’Œå†…å­˜ä½¿ç”¨

### ç”Ÿäº§ç¯å¢ƒæ£€æŸ¥æ¸…å•

- [ ] APIå¯†é’¥å·²æ­£ç¡®é…ç½®
- [ ] Webå¯†ç ä¿æŠ¤å·²å¯ç”¨
- [ ] é˜²ç«å¢™è§„åˆ™å·²è®¾ç½®
- [ ] å¤‡ä»½è„šæœ¬å·²é…ç½®
- [ ] ç›‘æ§å‘Šè­¦å·²è®¾ç½®
- [ ] æ—¥å¿—è½®è½¬å·²é…ç½®

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°éƒ¨ç½²é—®é¢˜ï¼Œè¯·ï¼š

1. æŸ¥çœ‹æœ¬æ–‡æ¡£çš„æ•…éšœæ’é™¤éƒ¨åˆ†
2. æ£€æŸ¥å®¹å™¨æ—¥å¿—: `docker-compose logs -f`
3. éªŒè¯é…ç½®æ–‡ä»¶: `docker-compose config`
4. æäº¤Issueå¹¶é™„ä¸Šè¯¦ç»†æ—¥å¿—

---

**ï¿½ï¿½ äº«å—ç®€å•é«˜æ•ˆçš„è‚¡ç¥¨åˆ†ææœåŠ¡ï¼** 